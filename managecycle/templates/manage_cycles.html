{% extends 'base.html' %}
{% block content %}
<h1>You are logged in as {{ username }}</h1>
{% if cycles_count > 1 %}
<h2>{{ cycles_count }} current cycles.</h2>
{% elif cycles_count == 0 %}
<h2>{{ cycles_count }} current cycles.</h2>
{% elif cycles_count == 1 %}
<h2>{{ cycles_count }} current cycle.</h2>
{% endif %}
<h2>Add Cycle</h2>
<form method="POST">
    {% csrf_token %}
       {{ cycle_form.as_p }}
        {% if not jobs %}
            <p>You are seeing an empty drop down list because you haven't added any Jobs to your account yet.
                You must do this before you can create a new job.
            </p>
            <p>You can follow the link here to Manage Jobs.</p>
            <div>
                <a href="#">Manage Jobs</a>
            </div>
        {% endif %}
    <button type="submit">Add Cycle</button>
</form>
<p>
{% for message in messages %}
    {% if 'manage_cycle' in message.tags %}
        {{ message }}
    {% endif %}
{% endfor %}
</p>
<hr>
<div>
    {% for item in cycles %}
    <div>
        <h4>Fileo Cycle ID: {{ item.cycle.id }}</h4>
        {% if item.cancelled %}
        <p>Cancelled</p>
        {% elif item.pending %}
        <p>Payment Pending</p>
        {% elif item.complete %}
        <p>Cycle Complete</p>
        {% else %}
        <p>Active</p>
        {% endif %}
        <h3>Cycle Title</h3>
        <p>{{ item.cycle.cycle_title }}</p>
        <h3>Attached Job</h3>
        <p>{{ item.cycle.job.job_title }}</p>
        <p>{{ item.cycle.job.job_number }}</p>
        <h3>Attached Client</h3>
        <p><strong>Name:</strong> {{ item.cycle.client.first_name}} {{ item.cycle.client.last_name}} 
        <p><strong>Username:</strong> {{ item.cycle.client.username }}</p></p>
        <p><strong>Email:</strong> {{ item.cycle.client.email }}</p></p>
        <p>
            <a href="{% url 'edit_cycle' username=username cycle_id=item.cycle.id %}">Edit Cycle</a>
        </p>
        <form method='POST' action="{% url 'reset_cycle' username=username cycle_id=item.cycle.id %}">
            {% csrf_token %}
            <button type='submit'>Reset Cycle</button>
        </form>
        <form method='POST' action="{% url 'cancel_cycle' username=username cycle_id=item.cycle.id %}">
            {% csrf_token %}
            {% if not item.cancelled %}
            <input type='hidden' name='cancel' value='True'>
            <button type='submit'>Cancel Cycle</button>
            {% elif item.cancelled %}
            <input type='hidden' name='cancel' value='False'>
            <button type='submit'>Re-instate Cycle</button>
            {% endif %}
        </form>
        <form method='POST' action="{% url 'delete_cycle' username=username cycle_id=item.cycle.id %}">
            {% csrf_token %}
            <button type='submit'>Delete Cycle</button>
        </form>
    </div>
    <hr>
    {% endfor %}
</div>
{% endblock %}