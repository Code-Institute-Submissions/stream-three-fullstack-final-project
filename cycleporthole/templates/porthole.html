{% extends 'base.html' %}
{% block content %}
<h1>Cycle Porthole</h1>

<p>You are logged in as {{ context.member.username }}</p>
<p>Fileo Cycle ID: {{ context.cycle.id }}</p>
{% if not cycle.cancelled %}
<p>Status: Active</p>
{% else %}
<p>Status: Cancelled</p>
{% endif %}
<h2>Client</h2>
<p>{{ context.cycle.client.username }}</p>
<p>{{ context.cycle.client.first_name }} {{ context.cycle.client.last_name }}</p>
<p>{{ context.client_profile.profile.company }}</p>
<p>{{ context.client_profile.profile.phone }}</p>
<h2>Job Title</h2>
<h3>{{ context.cycle.job.job_title }}</h3>
<h4>Job Number: {{ context.cycle.job.job_number }}</h4>
<h3>Cycle Description</h3>
<h4>Location</h4>
<p>@{{ context.cycle.location }}</p>
<h4>Description</h4>
<p>{{ context.cycle.description }}</p>
<h4>Dates</h4>
<p> Start Date: {{ context.cycle.start_date }}</p>
<p> End Date: {{ context.cycle.end_date }}</p>
<h4>Cycle Value</h4>
{% if context.cycle.cycle_value %}
<p>{{ context.cycle.cycle_value }}</p>
{% else %}
<p>Cycle Value not entered yet.</p>
{% endif %}
<hr>
<div>
    <h3>Upload Your Quote</h3>
    <img alt='Show image of PDF icon if uploaded'>
    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        {{ quote_form.as_p }}
        <!--<input type="hidden" name="file_type" value="quote">-->
        <button type="submit">Submit</button>
    </form>
    {% if context.quote %}
    <form action="{% url 'delete' username=context.member.username cycle_id=context.cycle.id client_username=context.cycle.client.username step='quote' %}">
        <button type="submit">Delete Quote</button>
    </form>
    <form action="{% url 'step_notify' username=context.member.username cycle_id=context.cycle.id client_username=context.cycle.client.username step='quote' %}">
        <button type="submit">Notify Client</button>
    </form>
    {% endif %}
    {% for message in messages %}
        {% if 'quote_delete' in message.tags %}
            <p>{{message}}</p>
        {% endif %}
    {% endfor %}
    <p>File uploaded at: {{ context.quote.uploaded_at }}</p>
    <ul>
        <li><a href="{{ context.quote.file.url }}" download="">Download File</a></li>
        <li><a href="{{ context.quote.file.url }}" target="_blank">View in Browser</a></li> 
    </ul>
    <div>
        <h4>Approval</h4>
        {% if context.cycle_status.approve_quote %}
            <p>Status: Approved</p>
        {% elif context.cycle_status.contest_quote %}
            <p>Status: Contested</p>
        {% else %}
            <p>No Status</p>
        {% endif %}
        <div>
            {% for message in messages %}
                {% if 'quote_message' in message.tags %}
                    {{message}}
                {% endif %}
            {% endfor %}
            <form action="{% url 'quote_status' username=context.member.username cycle_id=context.cycle.id client_username=context.cycle.client.username %}" method="POST">
                {% csrf_token %}
                <fieldset>
                    {{ context.status_form.as_p }}
                    <button type="submit">Submit</button>
                </fieldset>
            </form> 
        </div>
    </div>
</div>
<hr>
<div>
    <h3>Upload Your PO</h3>
    <img alt='Show image of PDF icon if uploaded'>
    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        {{ po_form.as_p }}
        <!--<input type="hidden" name="file_type" value="po">-->
        <button type="submit">Submit</button>
    </form>
    {% if context.po %}
    <form action="{% url 'delete' username=context.member.username cycle_id=context.cycle.id client_username=context.cycle.client.username step='po' %}">
        <button type="submit">Delete PO</button>
    </form>
    <form action="{% url 'step_notify' username=context.member.username cycle_id=context.cycle.id client_username=context.cycle.client.username step='po' %}">
        <button type="submit">Notify Client</button>
    </form>
    {% endif %}
    {% for message in messages %}
    {% if 'po_delete' in message.tags %}
        <p>{{message}}</p>
    {% endif %}
    {% endfor %}
    <p>File uploaded at: {{ context.po.uploaded_at }}</p>
    <ul>
        <li><a href="{{ context.po.file.url }}" download>Download File</a></li>
        <li><a href="{{ context.po.file.url }}" target="_blank">View in Browser</a></li> 
    </ul>
    <div>
        <h4>PO Status</h4>
        <h4>Approval</h4>
        {% if context.cycle_status.approve_po %}
            <p>Status: Approved</p>
        {% elif context.cycle_status.contest_po %}
            <p>Status: Contested</p>
        {% else %}
            <p>No Status</p>
        {% endif %}
        <div>
            {% for message in messages %}
                {% if 'po_message' in message.tags %}
                    {{message}}
                {% endif %}
            {% endfor %}
            <form action="{% url 'po_status' username=context.member.username cycle_id=context.cycle.id client_username=context.cycle.client.username %}" method="POST">
                <fieldset>
                    {% csrf_token %}
                    {{ context.status_form.as_p }}
                    <button type="submit">Set Status</button>
                </fieldset>
            </form>
        </div>
    </div>
</div>
<hr>
<div>
    <h3>Upload Your Invoice</h3>
    <img alt='Show image of PDF icon if uploaded'>
    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        {{ invoice_form.as_p }}
        <!--<input type="hidden" name="file_type" value="invoice">-->
        <button type="submit">Upload</button>
    </form>
    {% if context.invoice %}
    <form action="{% url 'delete' username=context.member.username cycle_id=context.cycle.id client_username=context.cycle.client.username step='invoice' %}">
        <button type="submit">Delete Invoice</button>
    </form>
    <form action="{% url 'step_notify' username=context.member.username cycle_id=context.cycle.id client_username=context.cycle.client.username step='invoice' %}">
        <button type="submit">Notify Client</button>
    </form>
    {% endif %}
    {% for message in messages %}
    {% if 'invoice_delete' in message.tags %}
        <p>{{message}}</p>
    {% endif %}
    {% endfor %}
    <p>File uploaded at: {{ context.invoice.uploaded_at }}</p>
    <ul>
        <li><a href="{{ context.invoice.file.url }}" download>Download File</a></li>
        <li><a href="{{ context.invoice.file.url }}" target="_blank">View in Browser</a></li> 
    </ul>
    <div>
        <h4>Invoice Status</h4>
        {% if context.cycle_status.approve_invoice %}
            <p>Status: Approved</p>
        {% elif context.cycle_status.contest_invoice %}
            <p>Status: Contested</p>
        {% else %}
            <p>No Status</p>
        {% endif %}
        <div>
            {% for message in messages %}
                {% if 'invoice_message' in message.tags %}
                        {{message}}
                {% endif %}
            {% endfor %}
            <form action="{% url 'invoice_status' username=context.member.username cycle_id=context.cycle.id client_username=context.cycle.client.username %}" method="POST">
                <fieldset>
                    {% csrf_token %}
                    {{ context.status_form.as_p }}
                    <button type="submit">Set Status</button>
                </fieldset>
            </form>
        </div>
        <br>
        {% if context.cycle_status.pending %}
        <div>
            <form action="{% url 'payment' username=context.member.username client_username=context.client.username cycle_id=context.cycle.id %}">
                <button>Payment</button>
            </form>
        </div>
        {% endif %}
    </div>
</div>
<hr>
{% endblock %}