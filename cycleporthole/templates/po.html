<!-- PO STEP PARTIAL -->

<section class="file-container {% if context.cycle_status.approve_quote %} file-container--padding {% endif %}">
    {% if request.user.is_client %}
        {% if not context.po %}
        <h2 class="porthole-upload-heading">Upload Your PO</h2>
        {% else %}
        <h2 class="porthole-upload-heading">View Your PO</h2>
        {% endif %}
    {% elif request.user.is_member %}
        <h2 class="porthole-upload-heading">View Your PO</h2>
    {% endif %}
    <!---FILE ICON ONLY SHOWS ON FILE UPLOADED -->
    <!------ VIEWABLE BY BOTH MEMBER AND CLIENT ------>
    
    <div class="quote-upload-container">
        {% if context.po %}
        <div>
            {% if context.cycle_status.approve_po %}
                <p class="porthole-status"><i class="far fa-thumbs-up cycles-results__overall-icons" aria-hidden="true"></i> Approved</p>
            {% elif context.cycle_status.contest_po %}
                <p class="porthole-status"><i class="fas fa-times cycles-results__overall-icons" aria-hidden="true"></i> Contested</p>
            {% else %}
                <p class="porthole-status"><i class="fas fa-minus cycles-results__overall-icons" aria-hidden="true"></i>Awaiting approval.</p>
            {% endif %}
        </div>
        <div class="uploaded-icon">
            <a href="{{ context.po.file.url }}" target="_blank">
                <div class="uploaded-icon__icon"></div>
            </a>
            <!--<p class="uploaded-icon__file-name">Click to view </p>-->
            <p>File uploaded on {{ context.quote.uploaded_at }}</p>
        </div>
        {% else %}
        <div class="uploaded-icon">
            <i class="fas fa-times no-file-icon" aria-hidden="true"></i>
            <p>No file yet.</p>
        </div>
        {% endif %}
        <!---- VIEWABLE BY CLIENT ONLY ---->
        {% if request.user.is_client %}
        {% if not context.cycle_status.approve_po %}
        <form class="upload-form" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            {{ po_form.as_p }}
            {% for message in messages %}
                {% if 'purchase_order_upload_error' in message.tags %}
                <p class="generic-success manage-success porthole-error">{{ message }}</p>
                {% endif %}
            {% endfor %}
            <button id="upload-browse__button" class="upload-form__browse-button" type="button"/>Browse Files</button>
            <!--<input type="hidden" name="file_type" value="quote">-->
            <button id="quote-submit__button" class="upload-form__button" type="submit">Upload</button>
        </form>
        {% endif %}
        {% endif %}
    </div>
    
    <!---- VIEWABLE BY CLIENT ONLY ---->
    {% if request.user.is_client %}
    {% if not context.cycle_status.approve_po %}
    <div class="file-action">
        {% if context.po %}
        <p>
            <a class="file-action__delete" href="{% url 'delete' username=context.member.username cycle_id=context.cycle.id step='po' %}">Delete PO</a>
        </p>
        <p>
            <a class="file-action__notify" href="{% url 'step_notify' username=context.member.username cycle_id=context.cycle.id step='po' %}">Notify Member</a>
        </p>
        {% if messages %}
            {% for message in messages %}
                {% if 'po' in message.tags %}
                <p class="generic-success manage-success porthole-success"> <i class="far fa-check-circle" aria-hidden="true"></i> {{ message }}</p>
                {% endif %}
            {% endfor %} 
        {% endif %}
        {% else %}
            {% if messages %}
                {% for message in messages %}
                    {% if 'po' in message.tags %}
                    <p class="generic-success manage-success porthole-success"> <i class="far fa-check-circle" aria-hidden="true"></i> {{ message }}</p>
                    {% endif %}
                {% endfor %} 
            {% endif %}
        {% endif %} 
    </div>
    {% endif %}
    {% endif %}

    <!-------- VIEWABLE BY MEMBER ONLY ---------------------->
    {% if request.user.is_member %}
    {% if not context.cycle_status.approve_po %}
    <div class="file-approval">
        {% for message in messages %}
            {% if 'po_message' in message.tags %}
                <p class="generic-success manage-success porthole-error">{{message}}</p>
            {% endif %}
        {% endfor %}
        
        {% if not context.cycle_status.approve_po and not context.cycle_status.contest_po %}
            <form class="file-approval__form" action="{% url 'po_status' username=context.member.username cycle_id=context.cycle.id %}" method="POST">
                {% csrf_token %}
                    {{ context.status_form.as_p }}
                <button class="file-approval__button" type="submit">Submit</button>
            </form>
        {% endif %}    
    </div>
    {% endif %}
    {% endif %}   
</section>

